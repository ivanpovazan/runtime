## Overview

This is an experiment of using NativeAOT dependency analysis scanner to work with Mono system module - `System.Private.CoreLib`.
To goal of the experiment is to use NativeAOT to output all the methods that need to be AOT compiled with Mono,
into a file (in .mibc format). This file would be used as an input to the MonoAOT compiler when performing fullAOT compilation
to compile only what is required for the app to run (similar to the PGO optimization).

The experiment should consist of two stages:
1. Optimize generics - The first stage of this experiment is to assist MonoAOT compilation with compilation of generics i.e. providing a list of generic instances needed during runtime.
2. Optimize full program - The later stage would be to expand this feature for all types.

## How to build

### Build the repo

The build the repository from repo root execute:
``` bash
../../../../build.sh mono+libs+clr.tools+clr.jit -c debug /p:MonoEnableLlvm=true /p:MonoLLVMUseCxx11Abi=true
```
- `mono+libs` builds Mono runtime, MonoAOT compiler and libraries with llvm backend
- `clr.tools+clr.jit` builds ILCompiler

### Build and run the HelloWorld app

To build and run the sample application with MonoAOT in fullAOT mode (`LOG=true` enables runtime logging)
``` bash
make run AOT=true LOG=true
```

To build and run the sample application with MonoAOT in fullAOT mode guided by DAGO (dependency analysis guided optimization) MIBC profile generated by ILC
``` bash
make run AOT=true ILC_DA=true LOG=true
```

To further adjust/filter collected methods by the DAGO adjust the `HelloWorld.csproj` file.
For example to include generic methods from all assemblies, the setup should look like:
```xml
<ReproResponseLines Include="#--scanmibcforassembly:$(AssemblyName)" />
<ReproResponseLines Include="--scanmibcforallgenerics" />
<ReproResponseLines Include="#--scanmibclogdump" />
```
For more information about available switches run ilc with `--help`

